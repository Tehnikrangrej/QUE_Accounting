generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model SuperAdmin {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tenants Tenant[]
}

model Tenant {
  id          String   @id @default(uuid())
  name        String
  isActive    Boolean  @default(true)

  createdById Int
  createdBy   SuperAdmin @relation(fields: [createdById], references: [id])

  users       User[]
  configuration TenantConfiguration?
  subscription  Subscription?

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  customers Customer[]
  invoices  Invoice[]
}


model User {
  id                   Int                  @id @default(autoincrement())
  email                String               @unique
  password             String
  name                 String?
  tenantId             String
  tenant               Tenant               @relation(fields: [tenantId], references: [id])
  isActive             Boolean              @default(true)
  createdAt            DateTime             @default(now())
  updatedAt            DateTime             @updatedAt
  permission           Permission?
  tenantConfigurations TenantConfiguration? @relation(fields: [tenantConfigurationsid], references: [id])
tenantConfigurationsid Int?
}

/// =========================
///    Customer
/// =========================
model Customer {
  id              String    @id @default(uuid())

   //Tenant Relation//
  tenantId        String
  tenant          Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade) 

  /// =========================
  ///      CUSTOMER DETAILS
  ///   =========================
  company         String
  vatNumber       String?
  phone           String?
  website         String?
  group           String?
  currency        String    @default("SYSTEM")
  defaultLanguage String    @default("SYSTEM")
  /// =========================
  ///      MAIN COMPANY ADDRESS
  ///   =========================
  address         String?
  city            String?
  state           String?
  zipCode         String?
  country         String?
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  billingCity     String?
  billingCountry  String?
  billingState    String?
  /// =========================
  ///      BILLING ADDRESS
  ///   =========================
  billingStreet   String?
  billingZipCode  String?
  shippingCity    String?
  shippingCountry String?
  shippingState   String?
  /// =========================
  ///      SHIPPING ADDRESS
  ///   =========================
  shippingStreet  String?
  shippingZipCode String?
  invoices        Invoice[]
}

model Invoice {
  id            String   @id @default(uuid())

  tenantId      String
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  /* =========================
     BASIC INFO
  ========================= */
  invoiceNumber String   @unique
  status        InvoiceStatus @default(DRAFT)

  invoiceDate   DateTime
  dueDate       DateTime

  currency      String   @default("AED")

  poNumber      String?
  poDate        DateTime?

  /* =========================
     CUSTOMER
  ========================= */
  customerId    String
  customer      Customer @relation(fields: [customerId], references: [id])

  /* =========================
     NOTES
  ========================= */
  adminNote     String?
  terms         String?

  /* =========================
     TOTALS
  ========================= */
  subTotal      Float    @default(0)
  totalTax      Float    @default(0)
  discount      Float    @default(0)
  grandTotal    Float    @default(0)

  /* =========================
     ITEMS
  ========================= */
  items         InvoiceItem[]

   pdfUrl        String?   

  /* =========================
     META
  ========================= */
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}
model InvoiceItem {
  id          String @id @default(uuid())

  invoiceId  String
  invoice    Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  description String

  hours       Float
  rate        Float

  taxPercent  Float   @default(0)
  taxAmount   Float   @default(0)

  amount      Float   // hours * rate (without tax)

  createdAt   DateTime @default(now())
}
enum InvoiceStatus {
  DRAFT
  GENERATED
  SENT
  PAID
  CANCELLED
}

model Permission {
  id               Int      @id @default(autoincrement())
  userId           Int      @unique
  canCreateInvoice Boolean  @default(false)
  canViewInvoice   Boolean  @default(false)
  canUpdateInvoice Boolean  @default(false)
  canDeleteInvoice Boolean  @default(false)

  canCreateCustomer  Boolean  @default(false)
  canViewCustomer    Boolean  @default(false)
  canUpdateCustomer  Boolean  @default(false)
  canDeleteCustomer  Boolean  @default(false)


   canEditTenantConfig    Boolean  @default(false)
  createdAt        DateTime @default(now())
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model TenantConfiguration {
  id                Int      @id @default(autoincrement())
  tenantId        String   @unique
  tenant           Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  companyName       String
  address           String?
  phone             String?
  email             String?
  website           String?
  trn               String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  accountName       String?
  accountNumber     String?
  bankAddress       String?
  bankName          String?
  companyLogo       String?
  iban              String?
  swiftCode         String?
  defaultFooterNote String?
  defaultTerms      String?

  users User[]
}
model Subscription {
  id           String   @id @default(uuid())

  tenantId     String   @unique
  tenant       Tenant   @relation(fields: [tenantId], references: [id])

  plan         SubscriptionPlan
  status       SubscriptionStatus

  startDate    DateTime
  endDate      DateTime?

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

enum SubscriptionStatus {
  ACTIVE
  INACTIVE
  EXPIRED
  CANCELLED
}

enum SubscriptionPlan {
  FREE
  BASIC
  PRO
  ENTERPRISE
}


